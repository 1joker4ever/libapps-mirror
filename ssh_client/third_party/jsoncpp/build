#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Copyright 2018 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

"""Build jsoncpp package."""

from __future__ import print_function

import os
import sys

FILESDIR = os.path.dirname(os.path.realpath(__file__))
sys.path.insert(0, os.path.join(FILESDIR, '..', '..', 'bin'))

import ssh_client  # pylint: disable=wrong-import-position


ARCHIVES = ('%(p)s.tar.gz',)


def src_configure(metadata):
    """Configure the source."""
    os.makedirs('../build', exist_ok=True)

    env = ssh_client.pnacl_env()
    ssh_client.run(['cmake', metadata['S'],
                    '-DCMAKE_INSTALL_PREFIX=/usr',
                    '-DJSONCPP_WITH_TESTS=OFF',
                    '-DJSONCPP_WITH_POST_BUILD_UNITTEST=OFF'],
                   cwd='../build', env=env)


def src_compile(_metadata):
    """Compile the source."""
    ssh_client.emake(cwd='../build')


def src_install(_metadata):
    """Install the package."""
    env = ssh_client.pnacl_env()
    ssh_client.emake('DESTDIR=%s' % (env['SYSROOT'],), 'install',
                     cwd='../build')


ssh_client.build_package(sys.modules[__name__])
